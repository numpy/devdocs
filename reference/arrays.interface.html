
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>The array interface protocol &#8212; NumPy v1.23.dev0 Manual</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    <link rel="stylesheet" type="text/css" href="../_static/plot_directive.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Datetimes and Timedeltas" href="arrays.datetime.html" />
    <link rel="prev" title="numpy.ma.where" href="generated/numpy.ma.where.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
<link rel="stylesheet" href="../_static/numpy.css" type="text/css" />

    <!-- PR #17220: This is added via javascript in versionwarning.js  -->
    <!-- link rel="canonical" href="http://numpy.org/doc/stable/reference/arrays.interface.html" / -->


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/numpylogo.svg" class="logo" alt="logo">
</a>      


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../user/index.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="index.html">
  API reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../dev/index.html">
  Development
 </a>
</li>

    
    <li class="nav-item">
        <a class="nav-link nav-external" href="https://numpy.org/numpy-tutorials/">Learn<i class="fas fa-external-link-alt"></i></a>
    </li>
    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/numpy/numpy" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/numpy_team" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="arrays.html">
   Array objects
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="arrays.ndarray.html">
     The N-dimensional array (
     <code class="xref py py-class docutils literal notranslate">
      <span class="pre">
       ndarray
      </span>
     </code>
     )
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="arrays.scalars.html">
     Scalars
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="arrays.dtypes.html">
     Data type objects (
     <code class="xref py py-class docutils literal notranslate">
      <span class="pre">
       dtype
      </span>
     </code>
     )
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="arrays.indexing.html">
     Indexing routines
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="arrays.nditer.html">
     Iterating Over Arrays
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="arrays.classes.html">
     Standard array subclasses
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="maskedarray.html">
     Masked arrays
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     The array interface protocol
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="arrays.datetime.html">
     Datetimes and Timedeltas
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="array_api.html">
   Array API Standard Compatibility
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="constants.html">
   Constants
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="ufuncs.html">
   Universal functions (
   <code class="xref py py-class docutils literal notranslate">
    <span class="pre">
     ufunc
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="routines.html">
   Routines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="typing.html">
   Typing (
   <code class="xref py py-mod docutils literal notranslate">
    <span class="pre">
     numpy.typing
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="global_state.html">
   Global State
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="distutils.html">
   Packaging (
   <code class="xref py py-mod docutils literal notranslate">
    <span class="pre">
     numpy.distutils
    </span>
   </code>
   )
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="distutils_guide.html">
   NumPy Distutils - Users Guide
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="distutils_status_migration.html">
   Status of
   <code class="docutils literal notranslate">
    <span class="pre">
     numpy.distutils
    </span>
   </code>
   and migration advice
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="c-api/index.html">
   NumPy C-API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="simd/index.html">
   CPU/SIMD Optimizations
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="swig.html">
   NumPy and SWIG
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#python-side">
   Python side
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#c-struct-access">
   C-struct access
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#type-description-examples">
   Type description examples
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#differences-with-array-interface-version-2">
   Differences with Array interface (Version 2)
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  <section id="the-array-interface-protocol">
<span id="arrays-interface"></span><span id="index-0"></span><h1>The array interface protocol<a class="headerlink" href="#the-array-interface-protocol" title="Permalink to this headline">¶</a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>This page describes the NumPy-specific API for accessing the contents of
a NumPy array from other C extensions. <span class="target" id="index-1"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3118"><strong>PEP 3118</strong></a> –
<a class="reference external" href="https://docs.python.org/3/c-api/buffer.html#c.PyObject_GetBuffer" title="(in Python v3.10)"><code class="xref c c-func docutils literal notranslate"><span class="pre">The</span> <span class="pre">Revised</span> <span class="pre">Buffer</span> <span class="pre">Protocol</span></code></a> introduces
similar, standardized API to Python 2.6 and 3.0 for any extension
module to use. <a class="reference external" href="http://cython.org/">Cython</a>’s buffer array support
uses the <span class="target" id="index-2"></span><a class="pep reference external" href="https://www.python.org/dev/peps/pep-3118"><strong>PEP 3118</strong></a> API; see the <a class="reference external" href="https://github.com/cython/cython/wiki/tutorials-numpy">Cython NumPy
tutorial</a>. Cython provides a way to write code that supports the buffer
protocol with Python versions older than 2.6 because it has a
backward-compatible implementation utilizing the array interface
described here.</p>
</div>
<dl class="field-list simple">
<dt class="field-odd">version</dt>
<dd class="field-odd"><p>3</p>
</dd>
</dl>
<p>The array interface (sometimes called array protocol) was created in
2005 as a means for array-like Python objects to re-use each other’s
data buffers intelligently whenever possible. The homogeneous
N-dimensional array interface is a default mechanism for objects to
share N-dimensional array memory and information.  The interface
consists of a Python-side and a C-side using two attributes.  Objects
wishing to be considered an N-dimensional array in application code
should support at least one of these attributes.  Objects wishing to
support an N-dimensional array in application code should look for at
least one of these attributes and use the information provided
appropriately.</p>
<p>This interface describes homogeneous arrays in the sense that each
item of the array has the same “type”.  This type can be very simple
or it can be a quite arbitrary and complicated C-like structure.</p>
<p>There are two ways to use the interface: A Python side and a C-side.
Both are separate attributes.</p>
<section id="python-side">
<h2>Python side<a class="headerlink" href="#python-side" title="Permalink to this headline">¶</a></h2>
<p>This approach to the interface consists of the object having an
<a class="reference internal" href="#object.__array_interface__" title="object.__array_interface__"><code class="xref py py-data docutils literal notranslate"><span class="pre">__array_interface__</span></code></a> attribute.</p>
<dl class="py data">
<dt class="sig sig-object py" id="object.__array_interface__">
<span class="sig-prename descclassname"><span class="pre">object.</span></span><span class="sig-name descname"><span class="pre">__array_interface__</span></span><a class="headerlink" href="#object.__array_interface__" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary of items (3 required and 5 optional).  The optional
keys in the dictionary have implied defaults if they are not
provided.</p>
<p>The keys are:</p>
<dl>
<dt><strong>shape</strong> (required)</dt><dd><p>Tuple whose elements are the array size in each dimension. Each
entry is an integer (a Python <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>).  Note that these
integers could be larger than the platform <code class="docutils literal notranslate"><span class="pre">int</span></code> or <code class="docutils literal notranslate"><span class="pre">long</span></code>
could hold (a Python <a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a> is a C <code class="docutils literal notranslate"><span class="pre">long</span></code>). It is up to the code
using this attribute to handle this appropriately; either by
raising an error when overflow is possible, or by using
<code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">long</span></code> as the C type for the shapes.</p>
</dd>
<dt><strong>typestr</strong> (required)</dt><dd><p>A string providing the basic type of the homogeneous array The
basic string format consists of 3 parts: a character describing
the byteorder of the data (<code class="docutils literal notranslate"><span class="pre">&lt;</span></code>: little-endian, <code class="docutils literal notranslate"><span class="pre">&gt;</span></code>:
big-endian, <code class="docutils literal notranslate"><span class="pre">|</span></code>: not-relevant), a character code giving the
basic type of the array, and an integer providing the number of
bytes the type uses.</p>
<p>The basic type character codes are:</p>
<table class="table">
<colgroup>
<col style="width: 7%" />
<col style="width: 93%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">t</span></code></p></td>
<td><p>Bit field (following integer gives the number of
bits in the bit field).</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">b</span></code></p></td>
<td><p>Boolean (integer type where all values are only <code class="docutils literal notranslate"><span class="pre">True</span></code> or
<code class="docutils literal notranslate"><span class="pre">False</span></code>)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">i</span></code></p></td>
<td><p>Integer</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">u</span></code></p></td>
<td><p>Unsigned integer</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">f</span></code></p></td>
<td><p>Floating point</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">c</span></code></p></td>
<td><p>Complex floating point</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">m</span></code></p></td>
<td><p>Timedelta</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">M</span></code></p></td>
<td><p>Datetime</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">O</span></code></p></td>
<td><p>Object (i.e. the memory contains a pointer to <a class="reference external" href="https://docs.python.org/3/c-api/structures.html#c.PyObject" title="(in Python v3.10)"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyObject</span></code></a>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">S</span></code></p></td>
<td><p>String (fixed-length sequence of char)</p></td>
</tr>
<tr class="row-odd"><td><p><code class="docutils literal notranslate"><span class="pre">U</span></code></p></td>
<td><p>Unicode (fixed-length sequence of <a class="reference external" href="https://docs.python.org/3/c-api/unicode.html#c.Py_UCS4" title="(in Python v3.10)"><code class="xref c c-type docutils literal notranslate"><span class="pre">Py_UCS4</span></code></a>)</p></td>
</tr>
<tr class="row-even"><td><p><code class="docutils literal notranslate"><span class="pre">V</span></code></p></td>
<td><p>Other (void * – each item is a fixed-size chunk of memory)</p></td>
</tr>
</tbody>
</table>
</dd>
<dt><strong>descr</strong> (optional)</dt><dd><p>A list of tuples providing a more detailed description of the
memory layout for each item in the homogeneous array.  Each
tuple in the list has two or three elements.  Normally, this
attribute would be used when <em>typestr</em> is <code class="docutils literal notranslate"><span class="pre">V[0-9]+</span></code>, but this is
not a requirement.  The only requirement is that the number of
bytes represented in the <em>typestr</em> key is the same as the total
number of bytes represented here.  The idea is to support
descriptions of C-like structs that make up array
elements.  The elements of each tuple in the list are</p>
<ol class="arabic simple">
<li><p>A string providing a name associated with this portion of
the datatype.  This could also be a tuple of <code class="docutils literal notranslate"><span class="pre">('full</span> <span class="pre">name',</span>
<span class="pre">'basic_name')</span></code> where basic name would be a valid Python
variable name representing the full name of the field.</p></li>
<li><p>Either a basic-type description string as in <em>typestr</em> or
another list (for nested structured types)</p></li>
<li><p>An optional shape tuple providing how many times this part
of the structure should be repeated.  No repeats are assumed
if this is not given.  Very complicated structures can be
described using this generic interface.  Notice, however,
that each element of the array is still of the same
data-type.  Some examples of using this interface are given
below.</p></li>
</ol>
<p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">[('',</span> <span class="pre">typestr)]</span></code></p>
</dd>
<dt><strong>data</strong> (optional)</dt><dd><p>A 2-tuple whose first argument is an integer (a long integer
if necessary) that points to the data-area storing the array
contents.  This pointer must point to the first element of
data (in other words any offset is always ignored in this
case). The second entry in the tuple is a read-only flag (true
means the data area is read-only).</p>
<p>This attribute can also be an object exposing the
<a class="reference external" href="https://docs.python.org/3/c-api/buffer.html#bufferobjects" title="(in Python v3.10)"><span class="xref std std-ref">buffer interface</span></a> which
will be used to share the data. If this key is not present (or
returns None), then memory sharing will be done
through the buffer interface of the object itself.  In this
case, the offset key can be used to indicate the start of the
buffer.  A reference to the object exposing the array interface
must be stored by the new object if the memory area is to be
secured.</p>
<p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">None</span></code></p>
</dd>
<dt><strong>strides</strong> (optional)</dt><dd><p>Either <code class="docutils literal notranslate"><span class="pre">None</span></code> to indicate a C-style contiguous array or
a tuple of strides which provides the number of bytes needed
to jump to the next array element in the corresponding
dimension. Each entry must be an integer (a Python
<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.10)"><code class="xref py py-class docutils literal notranslate"><span class="pre">int</span></code></a>). As with shape, the values may
be larger than can be represented by a C <code class="docutils literal notranslate"><span class="pre">int</span></code> or <code class="docutils literal notranslate"><span class="pre">long</span></code>; the
calling code should handle this appropriately, either by
raising an error, or by using <code class="docutils literal notranslate"><span class="pre">long</span> <span class="pre">long</span></code> in C. The
default is <code class="docutils literal notranslate"><span class="pre">None</span></code> which implies a C-style contiguous
memory buffer. In this model, the last dimension of the array
varies the fastest.  For example, the default strides tuple
for an object whose array entries are 8 bytes long and whose
shape is <code class="docutils literal notranslate"><span class="pre">(10,</span> <span class="pre">20,</span> <span class="pre">30)</span></code> would be <code class="docutils literal notranslate"><span class="pre">(4800,</span> <span class="pre">240,</span> <span class="pre">8)</span></code>.</p>
<p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">None</span></code> (C-style contiguous)</p>
</dd>
<dt><strong>mask</strong> (optional)</dt><dd><p><code class="docutils literal notranslate"><span class="pre">None</span></code> or an object exposing the array interface.  All
elements of the mask array should be interpreted only as true
or not true indicating which elements of this array are valid.
The shape of this object should be <em class="xref py py-obj">“broadcastable”</em> to the shape of the
original array.</p>
<p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">None</span></code> (All array values are valid)</p>
</dd>
<dt><strong>offset</strong> (optional)</dt><dd><p>An integer offset into the array data region. This can only be
used when data is <code class="docutils literal notranslate"><span class="pre">None</span></code> or returns a <code class="xref py py-class docutils literal notranslate"><span class="pre">buffer</span></code>
object.</p>
<p><strong>Default</strong>: <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
</dd>
<dt><strong>version</strong> (required)</dt><dd><p>An integer showing the version of the interface (i.e. 3 for
this version).  Be careful not to use this to invalidate
objects exposing future versions of the interface.</p>
</dd>
</dl>
</dd></dl>

</section>
<section id="c-struct-access">
<h2>C-struct access<a class="headerlink" href="#c-struct-access" title="Permalink to this headline">¶</a></h2>
<p>This approach to the array interface allows for faster access to an
array using only one attribute lookup and a well-defined C-structure.</p>
<dl class="py data">
<dt class="sig sig-object py" id="object.__array_struct__">
<span class="sig-prename descclassname"><span class="pre">object.</span></span><span class="sig-name descname"><span class="pre">__array_struct__</span></span><a class="headerlink" href="#object.__array_struct__" title="Permalink to this definition">¶</a></dt>
<dd><p>A <a class="reference external" href="https://docs.python.org/3/c-api/capsule.html#c.PyCapsule" title="(in Python v3.10)"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyCapsule</span></code></a> whose <code class="docutils literal notranslate"><span class="pre">pointer</span></code> member contains a
pointer to a filled <a class="reference internal" href="c-api/types-and-structures.html#c.PyArrayInterface" title="PyArrayInterface"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyArrayInterface</span></code></a> structure.  Memory
for the structure is dynamically created and the <a class="reference external" href="https://docs.python.org/3/c-api/capsule.html#c.PyCapsule" title="(in Python v3.10)"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyCapsule</span></code></a>
is also created with an appropriate destructor so the retriever of
this attribute simply has to apply <a class="reference external" href="https://docs.python.org/3/c-api/refcounting.html#c.Py_DECREF" title="(in Python v3.10)"><code class="xref c c-func docutils literal notranslate"><span class="pre">Py_DECREF</span></code></a> to the
object returned by this attribute when it is finished.  Also,
either the data needs to be copied out, or a reference to the
object exposing this attribute must be held to ensure the data is
not freed.  Objects exposing the <a class="reference internal" href="#object.__array_struct__" title="object.__array_struct__"><code class="xref py py-obj docutils literal notranslate"><span class="pre">__array_struct__</span></code></a> interface
must also not reallocate their memory if other objects are
referencing them.</p>
</dd></dl>

<p>The <a class="reference internal" href="c-api/types-and-structures.html#c.PyArrayInterface" title="PyArrayInterface"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyArrayInterface</span></code></a> structure is defined in <code class="docutils literal notranslate"><span class="pre">numpy/ndarrayobject.h</span></code>
as:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">typedef</span> <span class="n">struct</span> <span class="p">{</span>
  <span class="nb">int</span> <span class="n">two</span><span class="p">;</span>              <span class="o">/*</span> <span class="n">contains</span> <span class="n">the</span> <span class="n">integer</span> <span class="mi">2</span> <span class="o">--</span> <span class="n">simple</span> <span class="n">sanity</span> <span class="n">check</span> <span class="o">*/</span>
  <span class="nb">int</span> <span class="n">nd</span><span class="p">;</span>               <span class="o">/*</span> <span class="n">number</span> <span class="n">of</span> <span class="n">dimensions</span> <span class="o">*/</span>
  <span class="n">char</span> <span class="n">typekind</span><span class="p">;</span>        <span class="o">/*</span> <span class="n">kind</span> <span class="ow">in</span> <span class="n">array</span> <span class="o">---</span> <span class="n">character</span> <span class="n">code</span> <span class="n">of</span> <span class="n">typestr</span> <span class="o">*/</span>
  <span class="nb">int</span> <span class="n">itemsize</span><span class="p">;</span>         <span class="o">/*</span> <span class="n">size</span> <span class="n">of</span> <span class="n">each</span> <span class="n">element</span> <span class="o">*/</span>
  <span class="nb">int</span> <span class="n">flags</span><span class="p">;</span>            <span class="o">/*</span> <span class="n">flags</span> <span class="n">indicating</span> <span class="n">how</span> <span class="n">the</span> <span class="n">data</span> <span class="n">should</span> <span class="n">be</span> <span class="n">interpreted</span> <span class="o">*/</span>
                        <span class="o">/*</span>   <span class="n">must</span> <span class="nb">set</span> <span class="n">ARR_HAS_DESCR</span> <span class="n">bit</span> <span class="n">to</span> <span class="n">validate</span> <span class="n">descr</span> <span class="o">*/</span>
  <span class="n">Py_intptr_t</span> <span class="o">*</span><span class="n">shape</span><span class="p">;</span>   <span class="o">/*</span> <span class="n">A</span> <span class="n">length</span><span class="o">-</span><span class="n">nd</span> <span class="n">array</span> <span class="n">of</span> <span class="n">shape</span> <span class="n">information</span> <span class="o">*/</span>
  <span class="n">Py_intptr_t</span> <span class="o">*</span><span class="n">strides</span><span class="p">;</span> <span class="o">/*</span> <span class="n">A</span> <span class="n">length</span><span class="o">-</span><span class="n">nd</span> <span class="n">array</span> <span class="n">of</span> <span class="n">stride</span> <span class="n">information</span> <span class="o">*/</span>
  <span class="n">void</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>           <span class="o">/*</span> <span class="n">A</span> <span class="n">pointer</span> <span class="n">to</span> <span class="n">the</span> <span class="n">first</span> <span class="n">element</span> <span class="n">of</span> <span class="n">the</span> <span class="n">array</span> <span class="o">*/</span>
  <span class="n">PyObject</span> <span class="o">*</span><span class="n">descr</span><span class="p">;</span>      <span class="o">/*</span> <span class="n">NULL</span> <span class="ow">or</span> <span class="n">data</span><span class="o">-</span><span class="n">description</span> <span class="p">(</span><span class="n">same</span> <span class="k">as</span> <span class="n">descr</span> <span class="n">key</span>
                                <span class="n">of</span> <span class="n">__array_interface__</span><span class="p">)</span> <span class="o">--</span> <span class="n">must</span> <span class="nb">set</span> <span class="n">ARR_HAS_DESCR</span>
                                <span class="n">flag</span> <span class="ow">or</span> <span class="n">this</span> <span class="n">will</span> <span class="n">be</span> <span class="n">ignored</span><span class="o">.</span> <span class="o">*/</span>
<span class="p">}</span> <span class="n">PyArrayInterface</span><span class="p">;</span>
</pre></div>
</div>
<p>The flags member may consist of 5 bits showing how the data should be
interpreted and one bit showing how the Interface should be
interpreted.  The data-bits are <a class="reference internal" href="c-api/array.html#c.NPY_ARRAY_C_CONTIGUOUS" title="NPY_ARRAY_C_CONTIGUOUS"><code class="xref c c-macro docutils literal notranslate"><span class="pre">NPY_ARRAY_C_CONTIGUOUS</span></code></a> (0x1),
<a class="reference internal" href="c-api/array.html#c.NPY_ARRAY_F_CONTIGUOUS" title="NPY_ARRAY_F_CONTIGUOUS"><code class="xref c c-macro docutils literal notranslate"><span class="pre">NPY_ARRAY_F_CONTIGUOUS</span></code></a> (0x2), <a class="reference internal" href="c-api/array.html#c.NPY_ARRAY_ALIGNED" title="NPY_ARRAY_ALIGNED"><code class="xref c c-macro docutils literal notranslate"><span class="pre">NPY_ARRAY_ALIGNED</span></code></a> (0x100),
<a class="reference internal" href="c-api/array.html#c.NPY_ARRAY_NOTSWAPPED" title="NPY_ARRAY_NOTSWAPPED"><code class="xref c c-macro docutils literal notranslate"><span class="pre">NPY_ARRAY_NOTSWAPPED</span></code></a> (0x200), and <a class="reference internal" href="c-api/array.html#c.NPY_ARRAY_WRITEABLE" title="NPY_ARRAY_WRITEABLE"><code class="xref c c-macro docutils literal notranslate"><span class="pre">NPY_ARRAY_WRITEABLE</span></code></a> (0x400).  A final flag
<a class="reference internal" href="#c.NPY_ARR_HAS_DESCR" title="NPY_ARR_HAS_DESCR"><code class="xref c c-macro docutils literal notranslate"><span class="pre">NPY_ARR_HAS_DESCR</span></code></a> (0x800) indicates whether or not this structure
has the arrdescr field.  The field should not be accessed unless this
flag is present.</p>
<blockquote>
<div><dl class="c macro">
<dt class="sig sig-object c" id="c.NPY_ARR_HAS_DESCR">
<span class="sig-name descname"><span class="n"><span class="pre">NPY_ARR_HAS_DESCR</span></span></span><a class="headerlink" href="#c.NPY_ARR_HAS_DESCR" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

</div></blockquote>
<div class="admonition-new-since-june-16-2006 admonition">
<p class="admonition-title">New since June 16, 2006:</p>
<p>In the past most implementations used the <code class="docutils literal notranslate"><span class="pre">desc</span></code> member of the <code class="docutils literal notranslate"><span class="pre">PyCObject</span></code>
(now <a class="reference external" href="https://docs.python.org/3/c-api/capsule.html#c.PyCapsule" title="(in Python v3.10)"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyCapsule</span></code></a>) itself (do not confuse this with the “descr” member of
the <a class="reference internal" href="c-api/types-and-structures.html#c.PyArrayInterface" title="PyArrayInterface"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyArrayInterface</span></code></a> structure above — they are two separate
things) to hold the pointer to the object exposing the interface.
This is now an explicit part of the interface.  Be sure to take a
reference to the object and call <a class="reference external" href="https://docs.python.org/3/c-api/capsule.html#c.PyCapsule_SetContext" title="(in Python v3.10)"><code class="xref c c-func docutils literal notranslate"><span class="pre">PyCapsule_SetContext</span></code></a> before
returning the <a class="reference external" href="https://docs.python.org/3/c-api/capsule.html#c.PyCapsule" title="(in Python v3.10)"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyCapsule</span></code></a>, and configure a destructor to decref this
reference.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="xref py py-obj docutils literal notranslate"><span class="pre">__array_struct__</span></code> is considered legacy and should not be used for new
code. Use the <a class="reference external" href="https://docs.python.org/3/c-api/buffer.html" title="(in Python v3.10)"><span class="xref std std-doc">buffer protocol</span></a> or the DLPack protocol
<a class="reference internal" href="generated/numpy.from_dlpack.html#numpy.from_dlpack" title="numpy.from_dlpack"><code class="xref py py-obj docutils literal notranslate"><span class="pre">numpy.from_dlpack</span></code></a> instead.</p>
</div>
</section>
<section id="type-description-examples">
<h2>Type description examples<a class="headerlink" href="#type-description-examples" title="Permalink to this headline">¶</a></h2>
<p>For clarity it is useful to provide some examples of the type
description and corresponding <a class="reference internal" href="#object.__array_interface__" title="object.__array_interface__"><code class="xref py py-data docutils literal notranslate"><span class="pre">__array_interface__</span></code></a> ‘descr’
entries.  Thanks to Scott Gilbert for these examples:</p>
<p>In every case, the ‘descr’ key is optional, but of course provides
more information which may be important for various applications:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">*</span> <span class="n">Float</span> <span class="n">data</span>
    <span class="n">typestr</span> <span class="o">==</span> <span class="s1">&#39;&gt;f4&#39;</span>
    <span class="n">descr</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;f4&#39;</span><span class="p">)]</span>

<span class="o">*</span> <span class="n">Complex</span> <span class="n">double</span>
    <span class="n">typestr</span> <span class="o">==</span> <span class="s1">&#39;&gt;c8&#39;</span>
    <span class="n">descr</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;real&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;f4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;imag&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;f4&#39;</span><span class="p">)]</span>

<span class="o">*</span> <span class="n">RGB</span> <span class="n">Pixel</span> <span class="n">data</span>
    <span class="n">typestr</span> <span class="o">==</span> <span class="s1">&#39;|V3&#39;</span>
    <span class="n">descr</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;|u1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;|u1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;|u1&#39;</span><span class="p">)]</span>

<span class="o">*</span> <span class="n">Mixed</span> <span class="n">endian</span> <span class="p">(</span><span class="n">weird</span> <span class="n">but</span> <span class="n">could</span> <span class="n">happen</span><span class="p">)</span><span class="o">.</span>
    <span class="n">typestr</span> <span class="o">==</span> <span class="s1">&#39;|V8&#39;</span> <span class="p">(</span><span class="ow">or</span> <span class="s1">&#39;&gt;u8&#39;</span><span class="p">)</span>
    <span class="n">descr</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;big&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;i4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;little&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;i4&#39;</span><span class="p">)]</span>

<span class="o">*</span> <span class="n">Nested</span> <span class="n">structure</span>
    <span class="n">struct</span> <span class="p">{</span>
        <span class="nb">int</span> <span class="n">ival</span><span class="p">;</span>
        <span class="n">struct</span> <span class="p">{</span>
            <span class="n">unsigned</span> <span class="n">short</span> <span class="n">sval</span><span class="p">;</span>
            <span class="n">unsigned</span> <span class="n">char</span> <span class="n">bval</span><span class="p">;</span>
            <span class="n">unsigned</span> <span class="n">char</span> <span class="n">cval</span><span class="p">;</span>
        <span class="p">}</span> <span class="n">sub</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">typestr</span> <span class="o">==</span> <span class="s1">&#39;|V8&#39;</span> <span class="p">(</span><span class="ow">or</span> <span class="s1">&#39;&lt;u8&#39;</span> <span class="k">if</span> <span class="n">you</span> <span class="n">want</span><span class="p">)</span>
    <span class="n">descr</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;ival&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;i4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;sub&#39;</span><span class="p">,</span> <span class="p">[(</span><span class="s1">&#39;sval&#39;</span><span class="p">,</span><span class="s1">&#39;&lt;u2&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;bval&#39;</span><span class="p">,</span><span class="s1">&#39;|u1&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;cval&#39;</span><span class="p">,</span><span class="s1">&#39;|u1&#39;</span><span class="p">)</span> <span class="p">])</span> <span class="p">]</span>

<span class="o">*</span> <span class="n">Nested</span> <span class="n">array</span>
    <span class="n">struct</span> <span class="p">{</span>
        <span class="nb">int</span> <span class="n">ival</span><span class="p">;</span>
        <span class="n">double</span> <span class="n">data</span><span class="p">[</span><span class="mi">16</span><span class="o">*</span><span class="mi">4</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="n">typestr</span> <span class="o">==</span> <span class="s1">&#39;|V516&#39;</span>
    <span class="n">descr</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;ival&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;i4&#39;</span><span class="p">),</span> <span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;f8&#39;</span><span class="p">,(</span><span class="mi">16</span><span class="p">,</span><span class="mi">4</span><span class="p">))]</span>

<span class="o">*</span> <span class="n">Padded</span> <span class="n">structure</span>
    <span class="n">struct</span> <span class="p">{</span>
        <span class="nb">int</span> <span class="n">ival</span><span class="p">;</span>
        <span class="n">double</span> <span class="n">dval</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="n">typestr</span> <span class="o">==</span> <span class="s1">&#39;|V16&#39;</span>
    <span class="n">descr</span> <span class="o">==</span> <span class="p">[(</span><span class="s1">&#39;ival&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;i4&#39;</span><span class="p">),(</span><span class="s1">&#39;&#39;</span><span class="p">,</span><span class="s1">&#39;|V4&#39;</span><span class="p">),(</span><span class="s1">&#39;dval&#39;</span><span class="p">,</span><span class="s1">&#39;&gt;f8&#39;</span><span class="p">)]</span>
</pre></div>
</div>
<p>It should be clear that any structured type could be described using this
interface.</p>
</section>
<section id="differences-with-array-interface-version-2">
<h2>Differences with Array interface (Version 2)<a class="headerlink" href="#differences-with-array-interface-version-2" title="Permalink to this headline">¶</a></h2>
<p>The version 2 interface was very similar.  The differences were
largely aesthetic.  In particular:</p>
<ol class="arabic">
<li><p>The PyArrayInterface structure had no descr member at the end
(and therefore no flag ARR_HAS_DESCR)</p></li>
<li><p>The <code class="docutils literal notranslate"><span class="pre">context</span></code> member of the <a class="reference external" href="https://docs.python.org/3/c-api/capsule.html#c.PyCapsule" title="(in Python v3.10)"><code class="xref c c-type docutils literal notranslate"><span class="pre">PyCapsule</span></code></a> (formally the <code class="docutils literal notranslate"><span class="pre">desc</span></code>
member of the <code class="docutils literal notranslate"><span class="pre">PyCObject</span></code>) returned from <code class="docutils literal notranslate"><span class="pre">__array_struct__</span></code> was
not specified.  Usually, it was the object exposing the array (so
that a reference to it could be kept and destroyed when the
C-object was destroyed). It is now an explicit requirement that this field
be used in some way to hold a reference to the owning object.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Until August 2020, this said:</p>
<blockquote>
<div><p>Now it must be a tuple whose first element is a string with
“PyArrayInterface Version #” and whose second element is the object
exposing the array.</p>
</div></blockquote>
<p>This design was retracted almost immediately after it was proposed, in
&lt;<a class="reference external" href="https://mail.python.org/pipermail/numpy-discussion/2006-June/020995.html">https://mail.python.org/pipermail/numpy-discussion/2006-June/020995.html</a>&gt;.
Despite 14 years of documentation to the contrary, at no point was it
valid to assume that <code class="docutils literal notranslate"><span class="pre">__array_interface__</span></code> capsules held this tuple
content.</p>
</div>
</li>
<li><p>The tuple returned from <code class="docutils literal notranslate"><span class="pre">__array_interface__['data']</span></code> used to be a
hex-string (now it is an integer or a long integer).</p></li>
<li><p>There was no <code class="docutils literal notranslate"><span class="pre">__array_interface__</span></code> attribute instead all of the keys
(except for version) in the <code class="docutils literal notranslate"><span class="pre">__array_interface__</span></code> dictionary were
their own attribute: Thus to obtain the Python-side information you
had to access separately the attributes:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">__array_data__</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__array_shape__</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__array_strides__</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__array_typestr__</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__array_descr__</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__array_offset__</span></code></p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">__array_mask__</span></code></p></li>
</ul>
</li>
</ol>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="generated/numpy.ma.where.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">numpy.ma.where</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="arrays.datetime.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Datetimes and Timedeltas</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2008-2022, NumPy Developers.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.2.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>